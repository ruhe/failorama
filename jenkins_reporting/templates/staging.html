{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h4>Failed builds in <a style="color: black" href="{{ jenkins }}/view/All/job/{{ job }}">{{ job }}</a></h4>
    <span class="text-muted">For more information about staging mirrors see
        <a href="https://mirantis.jira.com/wiki/display/OC/Staging+Mirror+Duty" target="_blank">this link</a>.
    </span>
</div>


<div class="row">
<div class="col-md-4" id="top_by_target">
    <h4>Stats</h4>
    <ul class="list-group" style="padding-top: 40px">
        <li class="list-group-item disabled">{{ job }} stats</li>
        <li class="list-group-item">Total number of builds <span class="pull-right label label-danger">{{ total_builds_num }}</span></li>
        <li class="list-group-item">Total number of failed builds <span class="pull-right label label-danger">{{ total_failed_builds_num }}</span></li>
        <li class="list-group-item">Success ratio <span class="pull-right label label-danger">{{ success_ratio }}</span></li>
        <li class="list-group-item">Avg number of failures per week <span class="pull-right label label-danger">{{ avg_failed_per_week }}</span></li>
        <li class="list-group-item">Number of failures last week <span class="pull-right label label-danger">{{ failed_last_week }}</span></li>
    </ul>
</div>

<div class="col-md-4" id="top_by_target">
    <h4>Top by project</h4>
    <svg></svg>
</div>

<div class="col-md-4" id="top_by_team">
    <h4>Top by team</h4>
    <svg></svg>
</div>
</div>

<script>
function render_chart(chart_id, data) {
    nv.addGraph(function() {
      var chart = nv.models.pieChart()
          .x(function(d) { return d.label })
          .y(function(d) { return d.value })
          .showLabels(true)
          .showLegend(false);

        d3.select("#" + chart_id + " svg")
            .datum(data)
          .transition().duration(1200)
            .call(chart);

      return chart;
    });
}

render_chart("top_by_target", {{ top_by_target|safe }});
render_chart("top_by_team", {{ top_by_team|safe }});
</script>

<div class="row">
{% include "staging_builds.html" %}
</div>
{% endblock %}